html_content %>%
html_children %>%
html_attr("href")
},
year = {
html_content %>%
html_text() %>%
as.numeric()
}
) %>%
filter(year == reference_year) %>%
mutate(href = glue("curl {href}/download | funzip")) %>%
pull(href) %>%
fread(encoding = "Latin-1") %>%
as_tibble()
data %>%
mutate(latitude = parse_double(latitude, locale = locale(decimal_mark = ',')),
longitude = parse_double(longitude, locale = locale(decimal_mark = ',')),
km = parse_double(km, locale = locale(decimal_mark = ',')),
id = as.character(id),
br = as.character(br),
timestamp = parse_date_time(glue("{data_inversa} {horario}"), "Ymd HMS", truncated = 3),
municipio = str_to_title(municipio),
data_inversa = NULL,
horario = NULL,
dia_semana = NULL)
}
slow_foo <- slowly(get_raw_accidents, rate_delay(5, max_times = 100))
tibble(ano = 2010:2020,
data = map(ano, ~ slow_foo(.x))) %T>%
saveRDS("R/Dados/painel_raw.Rds")
library(glue)
get_raw_accidents <- function(reference_year) {
html_content <-
read_html("https://portal.prf.gov.br/dados-abertos-acidentes") %>%
html_node("#acontent ul") %>%
html_nodes("li")
data <- tibble(
href = {
html_content %>%
html_children %>%
html_attr("href")
},
year = {
html_content %>%
html_text() %>%
as.numeric()
}
) %>%
filter(year == reference_year) %>%
mutate(href = glue("curl {href}/download | funzip")) %>%
pull(href) %>%
fread(encoding = "Latin-1") %>%
as_tibble()
data %>%
mutate(latitude = parse_double(latitude, locale = locale(decimal_mark = ',')),
longitude = parse_double(longitude, locale = locale(decimal_mark = ',')),
km = parse_double(km, locale = locale(decimal_mark = ',')),
id = as.character(id),
br = as.character(br),
timestamp = parse_date_time(glue("{data_inversa} {horario}"), "Ymd HMS", truncated = 3),
municipio = str_to_title(municipio),
data_inversa = NULL,
horario = NULL,
dia_semana = NULL)
}
slow_foo <- slowly(get_raw_accidents, rate_delay(5, max_times = 100))
tibble(ano = 2010:2020,
data = map(ano, ~ slow_foo(.x))) %T>%
saveRDS("R/Dados/painel_raw.Rds")
reference_year = 2017
html_content <-
read_html("https://portal.prf.gov.br/dados-abertos-acidentes") %>%
html_node("#acontent ul") %>%
html_nodes("li")
data <- tibble(
href = {
html_content %>%
html_children %>%
html_attr("href")
},
year = {
html_content %>%
html_text() %>%
as.numeric()
}
) %>%
filter(year == reference_year) %>%
mutate(href = glue("curl {href}/download | funzip")) %>%
pull(href) %>%
fread(encoding = "Latin-1") %>%
as_tibble()
data
data %>%
mutate(latitude = parse_double(latitude, locale = locale(decimal_mark = ',')),
longitude = parse_double(longitude, locale = locale(decimal_mark = ',')),
km = parse_double(km, locale = locale(decimal_mark = ',')),
id = as.character(id),
br = as.character(br),
timestamp = parse_date_time(glue("{data_inversa} {horario}"), "Ymd HMS", truncated = 3),
municipio = str_to_title(municipio),
data_inversa = NULL,
horario = NULL,
dia_semana = NULL)
library(stringr)
data %>%
mutate(latitude = parse_double(latitude, locale = locale(decimal_mark = ',')),
longitude = parse_double(longitude, locale = locale(decimal_mark = ',')),
km = parse_double(km, locale = locale(decimal_mark = ',')),
id = as.character(id),
br = as.character(br),
timestamp = parse_date_time(glue("{data_inversa} {horario}"), "Ymd HMS", truncated = 3),
municipio = str_to_title(municipio),
data_inversa = NULL,
horario = NULL,
dia_semana = NULL)
data <- tibble(
href = {
html_content %>%
html_children %>%
html_attr("href")
},
year = {
html_content %>%
html_text() %>%
as.numeric()
}
) %>%
filter(year == reference_year) %>%
mutate(href = glue("curl {href}/download | funzip")) %>%
pull(href) %>%
fread(encoding = "Latin-1") %>%
as_tibble()
data
data %>%
mutate(latitude = parse_double(latitude, locale = locale(decimal_mark = ',')),
longitude = parse_double(longitude, locale = locale(decimal_mark = ',')),
km = parse_double(km, locale = locale(decimal_mark = ',')),
id = as.character(id),
br = as.character(br),
timestamp = parse_date_time(glue("{data_inversa} {horario}"), "Ymd HMS", truncated = 3),
municipio = str_to_title(municipio),
data_inversa = NULL,
horario = NULL,
dia_semana = NULL)
get_raw_accidents <- function(reference_year) {
html_content <-
read_html("https://portal.prf.gov.br/dados-abertos-acidentes") %>%
html_node("#acontent ul") %>%
html_nodes("li")
data <- tibble(
href = {
html_content %>%
html_children %>%
html_attr("href")
},
year = {
html_content %>%
html_text() %>%
as.numeric()
}
) %>%
filter(year == reference_year) %>%
mutate(href = glue("curl {href}/download | funzip")) %>%
pull(href) %>%
fread(encoding = "Latin-1") %>%
as_tibble()
data %>%
mutate(latitude = parse_double(latitude, locale = locale(decimal_mark = ',')),
longitude = parse_double(longitude, locale = locale(decimal_mark = ',')),
km = parse_double(km, locale = locale(decimal_mark = ',')),
id = as.character(id),
br = as.character(br),
timestamp = parse_date_time(glue("{data_inversa} {horario}"), "Ymd HMS", truncated = 3),
municipio = str_to_title(municipio),
mun_uf = glue("{municipio} - {uf}"),
data_inversa = NULL,
horario = NULL,
dia_semana = NULL)
}
slow_foo <- slowly(get_raw_accidents, rate_delay(5, max_times = 100))
tibble(ano = 2010:2020,
data = map(ano, ~ slow_foo(.x))) %T>%
saveRDS("R/Dados/painel_raw.Rds")
data <- tibble(
href = {
html_content %>%
html_children %>%
html_attr("href")
},
year = {
html_content %>%
html_text() %>%
as.numeric()
}
) %>%
filter(year == reference_year) %>%
mutate(href = glue("curl {href}/download | funzip")) %>%
pull(href) %>%
fread(encoding = "Latin-1") %>%
as_tibble()
data
data$latitude
data %>%
mutate(latitude = parse_double(latitude, locale = locale(decimal_mark = ',')),
longitude = parse_double(longitude, locale = locale(decimal_mark = ',')),
km = parse_double(km, locale = locale(decimal_mark = ',')),
id = as.character(id),
br = as.character(br),
timestamp = parse_date_time(glue("{data_inversa} {horario}"), "Ymd HMS", truncated = 3),
municipio = str_to_title(municipio),
mun_uf = glue("{municipio} - {uf}"),
data_inversa = NULL,
horario = NULL,
dia_semana = NULL)
get_raw_accidents <- function(reference_year) {
html_content <-
read_html("https://portal.prf.gov.br/dados-abertos-acidentes") %>%
html_node("#acontent ul") %>%
html_nodes("li")
data <- tibble(
href = {
html_content %>%
html_children %>%
html_attr("href")
},
year = {
html_content %>%
html_text() %>%
as.numeric()
}
) %>%
filter(year == reference_year) %>%
mutate(href = glue("curl {href}/download | funzip")) %>%
pull(href) %>%
fread(encoding = "Latin-1") %>%
as_tibble()
data %>%
mutate(km = parse_double(km, locale = locale(decimal_mark = ',')),
id = as.character(id),
br = as.character(br),
timestamp = parse_date_time(glue("{data_inversa} {horario}"), "Ymd HMS", truncated = 3),
municipio = str_to_title(municipio),
mun_uf = glue("{municipio} - {uf}"),
data_inversa = NULL,
horario = NULL,
dia_semana = NULL)
}
slow_foo <- slowly(get_raw_accidents, rate_delay(5, max_times = 100))
tibble(ano = 2010:2020,
data = map(ano, ~ slow_foo(.x))) %T>%
saveRDS("R/Dados/painel_raw.Rds")
rm(data)
get_raw_accidents <- function(reference_year) {
html_content <-
read_html("https://portal.prf.gov.br/dados-abertos-acidentes") %>%
html_node("#acontent ul") %>%
html_nodes("li")
.data <- tibble(
href = {
html_content %>%
html_children %>%
html_attr("href")
},
year = {
html_content %>%
html_text() %>%
as.numeric()
}
) %>%
filter(year == reference_year) %>%
mutate(href = glue("curl {href}/download | funzip")) %>%
pull(href) %>%
fread(encoding = "Latin-1") %>%
as_tibble()
.data %>%
mutate(id = as.character(id),
br = as.character(br),
timestamp = parse_date_time(glue("{data_inversa} {horario}"), "Ymd HMS", truncated = 3),
municipio = str_to_title(municipio),
mun_uf = glue("{municipio} - {uf}"),
data_inversa = NULL,
horario = NULL,
dia_semana = NULL)
}
slow_foo <- slowly(get_raw_accidents, rate_delay(5, max_times = 100))
tibble(ano = 2010:2020,
data = map(ano, ~ slow_foo(.x))) %T>%
saveRDS("R/Dados/painel_raw.Rds")
get_raw_accidents <- function(reference_year) {
html_content <-
read_html("https://portal.prf.gov.br/dados-abertos-acidentes") %>%
html_node("#acontent ul") %>%
html_nodes("li")
acidentes <- tibble(
href = {
html_content %>%
html_children %>%
html_attr("href")
},
year = {
html_content %>%
html_text() %>%
as.numeric()
}
) %>%
filter(year == reference_year) %>%
mutate(href = glue("curl {href}/download | funzip")) %>%
pull(href) %>%
fread(encoding = "Latin-1") %>%
as_tibble()
acidentes %>%
mutate(id = as.character(id),
br = as.character(br),
timestamp = parse_date_time(glue("{data_inversa} {horario}"), "Ymd HMS", truncated = 3),
municipio = str_to_title(municipio),
mun_uf = glue("{municipio} - {uf}"),
data_inversa = NULL,
horario = NULL,
dia_semana = NULL)
}
slow_foo <- slowly(get_raw_accidents, rate_delay(5, max_times = 100))
tibble(ano = 2010:2020,
data = map(ano, ~ slow_foo(.x))) %T>%
saveRDS("R/Dados/painel_raw.Rds")
html_content <-
read_html("https://portal.prf.gov.br/dados-abertos-acidentes") %>%
html_node("#acontent ul") %>%
html_nodes("li")
acidentes <- tibble(
href = {
html_content %>%
html_children %>%
html_attr("href")
},
year = {
html_content %>%
html_text() %>%
as.numeric()
}
) %>%
filter(year == reference_year) %>%
mutate(href = glue("curl {href}/download | funzip")) %>%
pull(href) %>%
fread(encoding = "Latin-1") %>%
as_tibble()
acidentes
acidentes %>%
mutate(id = as.character(id),
br = as.character(br),
timestamp = parse_date_time(glue("{data_inversa} {horario}"), "Ymd HMS", truncated = 3),
municipio = str_to_title(municipio),
mun_uf = glue("{municipio} - {uf}"),
data_inversa = NULL,
horario = NULL,
dia_semana = NULL)
ibble(
href = {
html_content %>%
html_children %>%
html_attr("href")
},
year = {
html_content %>%
html_text() %>%
as.numeric()
}
)
tibble(
href = {
html_content %>%
html_children %>%
html_attr("href")
},
year = {
html_content %>%
html_text() %>%
as.numeric()
}
)
get_raw_accidents <- function(reference_year) {
html_content <-
read_html("https://portal.prf.gov.br/dados-abertos-acidentes") %>%
html_node("#acontent ul") %>%
html_nodes("li")
acidentes <- tibble(
href = {
html_content %>%
html_children %>%
html_attr("href")
},
year = {
html_content %>%
html_text() %>%
as.numeric()
}
) %>%
filter(year == reference_year) %>%
mutate(href = glue("curl {href}/download | funzip")) %>%
pull(href) %>%
fread(encoding = "Latin-1") %>%
as_tibble()
acidentes %>%
mutate(id = as.character(id),
br = as.character(br),
timestamp = parse_date_time(glue("{data_inversa} {horario}"), "Ymd HMS", truncated = 3),
municipio = str_to_title(municipio),
mun_uf = glue("{municipio} - {uf}"),
data_inversa = NULL,
horario = NULL,
dia_semana = NULL)
}
slow_foo <- slowly(get_raw_accidents, rate_delay(5, max_times = 100))
tibble(ano = 2007:2020,
data = map(ano, ~ slow_foo(.x))) %T>%
saveRDS("R/Dados/painel_raw.Rds")
tibble(ano = 2007:2020,
data = map(ano, ~ get_raw_accidents(.x))) %T>%
saveRDS("R/Dados/painel_raw.Rds")
get_raw_accidents <- function(reference_year) {
html_content <-
read_html("https://portal.prf.gov.br/dados-abertos-acidentes") %>%
html_node("#acontent ul") %>%
html_nodes("li")
acidentes <- tibble(
href = {
html_content %>%
html_children %>%
html_attr("href")
},
year = {
html_content %>%
html_text() %>%
as.numeric()
}
) %>%
filter(year == reference_year) %>%
mutate(href = glue("curl {href}/download | funzip")) %>%
pull(href) %>%
fread(encoding = "Latin-1") %>%
as_tibble()
acidentes %>%
mutate(id = as.character(id),
br = as.character(br),
timestamp = parse_date_time(glue("{data_inversa} {horario}"), "Ymd HMS", truncated = 3),
municipio = str_to_title(municipio),
mun_uf = glue("{municipio} - {uf}"),
data_inversa = NULL,
horario = NULL,
dia_semana = NULL) %>%
select(-data_inversa, -horario, -dia_semana)
}
tibble(ano = 2007:2020,
data = map(ano, ~ get_raw_accidents(.x))) %T>%
saveRDS("R/Dados/painel_raw.Rds")
get_raw_accidents <- function(reference_year) {
html_content <-
read_html("https://portal.prf.gov.br/dados-abertos-acidentes") %>%
html_node("#acontent ul") %>%
html_nodes("li")
acidentes <- tibble(
href = {
html_content %>%
html_children %>%
html_attr("href")
},
year = {
html_content %>%
html_text() %>%
as.numeric()
}
) %>%
filter(year == reference_year) %>%
mutate(href = glue("curl {href}/download | funzip")) %>%
pull(href) %>%
fread(encoding = "Latin-1") %>%
as_tibble()
acidentes %>%
mutate(id = as.character(id),
br = as.character(br),
timestamp = parse_date_time(glue("{data_inversa} {horario}"), "Ymd HMS", truncated = 3),
municipio = str_to_title(municipio),
mun_uf = glue("{municipio} - {uf}")) %>%
select(-data_inversa, -horario, -dia_semana)
}
tibble(ano = 2007:2020,
data = map(ano, ~ get_raw_accidents(.x))) %T>%
saveRDS("R/Dados/painel_raw.Rds")
tibble(ano = 2015:2020,
data = map(ano, ~ get_raw_accidents(.x))) %T>%
saveRDS("R/Dados/painel_raw.Rds")
tibble(ano = 2015:2020) %>%
mutate(data = map(ano, ~ get_raw_accidents(.x))) %T>%
saveRDS("R/Dados/painel_raw.Rds")
get_raw_accidents(2019)
get_raw_accidents(2020)
get_raw_accidents(2015)
get_raw_accidents(2016)
get_raw_accidents(2017)
get_raw_accidents(2018)
tibble(ano = 2017:2020) %>%
mutate(data = map(ano, ~ get_raw_accidents(.x))) %T>%
saveRDS("R/Dados/painel_raw.Rds")
readRDS("R/Dados/painel_raw.Rds") %>%
pull(data) %>%
reduce(bind_rows)
library(electionsBR)
install.packages("electionsBR")
library(electionsBR)
electionsBR::uf_br()
electionsBR::vote_mun_zone_fed(2020)
electionsBR::vote_mun_zone_fed(2018)
